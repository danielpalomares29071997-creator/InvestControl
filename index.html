<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Investimentos Pro</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <nav class="sidebar">
        <div class="brand">
            <span class="material-icons-outlined">insights</span>
            InvestControl
        </div>
        
        <div class="nav-links">
            <div class="menu-category">Geral</div>
            <a class="menu-item active" onclick="showPage('dashboard', this)">
                <span class="material-icons-outlined">dashboard</span> Resumo Geral
            </a>
            <a class="menu-item" onclick="showPage('evolucao', this)">
                <span class="material-icons-outlined">trending_up</span> Evolução
            </a>
            <!-- NOVO MENU -->
            <a class="menu-item" onclick="showPage('comparativo', this)">
                <span class="material-icons-outlined">pie_chart</span> Comparativo (Meta)
            </a>

            <div class="menu-category">Operacional</div>
            <a class="menu-item" onclick="showPage('carteira_giro', this)">
                <span class="material-icons-outlined">sync_alt</span> Carteira Giro
            </a>
            <a class="menu-item" onclick="showPage('carteira_pessoal', this)">
                <span class="material-icons-outlined">account_balance_wallet</span> Carteira Pessoal
            </a>
            <a class="menu-item" onclick="showPage('aportes', this)">
                <span class="material-icons-outlined">add_circle</span> Novos Aportes
            </a>
            <!-- NOVO MENU -->
            <a class="menu-item" onclick="showPage('planejamento', this)">
                <span class="material-icons-outlined">edit_calendar</span> Planejamento Anual
            </a>
            <a class="menu-item" onclick="showPage('historico', this)">
                <span class="material-icons-outlined">history</span> Histórico
            </a>
        </div>

        <div style="border-top: 1px solid var(--border-color); padding-top: 10px;">
            <a class="menu-item" onclick="checkPasswordAndShowConfig(this)">
                <span class="material-icons-outlined">settings</span> Configurações
            </a>
        </div>
    </nav>

    <main class="main-content">

        <!-- DASHBOARD GERAL -->
        <section id="dashboard" class="page-section active-section">
            <div class="page-header">
                <div class="page-title">
                    <h2>Dashboard 2026</h2>
                    <p>Visão geral da sua performance financeira</p>
                </div>
                <button class="btn btn-primary" onclick="goToAportes()">+ Novo Aporte</button>
            </div>
            <div class="kpi-grid">
                <div class="card">
                    <div class="kpi-label">Patrimônio Investido</div>
                    <div class="kpi-value" id="dashTotalInvested">R$ 0,00</div>
                    <small class="text-green">Total acumulado</small>
                </div>
                <div class="card">
                    <div class="kpi-label">Disponível p/ Giro</div>
                    <div class="kpi-value text-blue" id="dashBalanceReinvest">R$ 0,00</div>
                </div>
                <div class="card">
                    <div class="kpi-label">Retirado (Pessoal)</div>
                    <div class="kpi-value text-yellow" id="dashBalancePersonal">R$ 0,00</div>
                </div>
                <div class="card">
                    <div class="kpi-label">Próx. Vencimento</div>
                    <div class="kpi-value" style="font-size: 1.4rem;" id="dashNextExpiry">--/--</div>
                    <small class="text-secondary" id="dashNextExpiryName">-</small>
                </div>
            </div>
            <div class="charts-row">
                <div class="card">
                    <div class="kpi-label" style="margin-bottom: 20px;">Alocação de Ativos</div>
                    <div class="chart-container"><canvas id="pieChart"></canvas></div>
                </div>
                <div class="card">
                    <div class="kpi-label" style="margin-bottom: 20px;">Distribuição (Valores)</div>
                    <div class="chart-container"><canvas id="barChart"></canvas></div>
                </div>
            </div>
        </section>

        <!-- EVOLUÇÃO (Com novos filtros e paginação) -->
        <section id="evolucao" class="page-section">
            <div class="page-header">
                <div class="page-title">
                    <h2>Evolução Patrimonial</h2>
                    <p>Acompanhe o crescimento no período selecionado</p>
                </div>
            </div>

            <!-- Filtros Alterados -->
            <div class="card" style="margin-bottom: 30px;">
                <div class="filters-bar">
                    <div class="filter-item">
                        <label>De (Data Inicial)</label>
                        <input type="date" id="filterStartDate" class="form-control" onchange="updateEvolutionChart()">
                    </div>
                    <div class="filter-item">
                        <label>Até (Data Final)</label>
                        <input type="date" id="filterEndDate" class="form-control" onchange="updateEvolutionChart()">
                    </div>
                    <div class="filter-item">
                        <label>Tipo</label>
                        <select id="filterType" class="form-control" onchange="updateEvolutionChart()">
                            <option value="all">Todos</option>
                            <option>Renda Fixa</option>
                            <option>Ações</option>
                            <option>FIIs</option>
                            <option>Cripto</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-bottom: 30px;">
                <div class="kpi-label" style="margin-bottom: 20px;">Curva de Crescimento</div>
                <div class="chart-container" style="height: 400px;">
                    <canvas id="evolutionChart"></canvas>
                </div>
            </div>

            <div class="card">
                <div class="kpi-label">Detalhamento Numérico</div>
                <div class="table-container">
                    <table id="evolutionTable">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Patrimônio Projetado</th>
                                <th>Crescimento</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <!-- Controles de Paginação -->
                <div class="pagination-controls" style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px;">
                    <button class="btn-icon" onclick="changePage(-1)">◀</button>
                    <span id="pageIndicator" style="align-self: center; color: var(--text-secondary);">Página 1</span>
                    <button class="btn-icon" onclick="changePage(1)">▶</button>
                </div>
            </div>
        </section>

        <!-- NOVO: COMPARATIVO (META vs REAL) -->
        <section id="comparativo" class="page-section">
            <div class="page-header">
                <div class="page-title">
                    <h2>Planejado vs Realizado</h2>
                    <p>Compare suas metas anuais com o que foi efetivamente aportado.</p>
                </div>
            </div>

            <div class="kpi-grid">
                <div class="card">
                    <div class="kpi-label">Meta Anual (Total)</div>
                    <div class="kpi-value" id="compTotalPlanned">R$ 0,00</div>
                </div>
                <div class="card">
                    <div class="kpi-label">Realizado Anual</div>
                    <div class="kpi-value text-green" id="compTotalRealized">R$ 0,00</div>
                </div>
                <div class="card">
                    <div class="kpi-label">Atingimento da Meta</div>
                    <div class="kpi-value text-blue" id="compPercentage">0%</div>
                </div>
            </div>

            <div class="charts-row">
                <div class="card" style="flex: 2;">
                    <div class="kpi-label" style="margin-bottom: 20px;">Comparativo Mensal (Barras)</div>
                    <div class="chart-container">
                        <canvas id="compBarChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- CARTEIRAS (Giro e Pessoal) -->
        <section id="carteira_giro" class="page-section">
            <div class="page-header"><h2>Carteira de Giro</h2></div>
            <div class="kpi-grid">
                <div class="card" style="border-left: 4px solid var(--accent-blue);">
                    <div class="kpi-label">Disponível</div>
                    <div class="kpi-value text-blue" id="balanceReinvest">R$ 0,00</div>
                </div>
                <div class="card" style="display: flex; gap: 15px; justify-content: center;">
                    <button class="btn btn-primary" onclick="handleTransaction('deposit', 'reinvest')">Adicionar</button>
                    <button class="btn btn-danger" onclick="handleTransaction('withdraw', 'reinvest')">Retirar</button>
                </div>
            </div>
            <div class="card">
                <div class="table-container">
                    <table><thead><tr><th>Data</th><th>Tipo</th><th>Desc</th><th>Valor</th><th>Ação</th></tr></thead><tbody id="tableBodyReinvest"></tbody></table>
                </div>
            </div>
        </section>

        <section id="carteira_pessoal" class="page-section">
            <div class="page-header"><h2>Carteira Pessoal</h2></div>
            <div class="kpi-grid">
                <div class="card" style="border-left: 4px solid var(--accent-yellow);">
                    <div class="kpi-label">Saldo Pessoal</div>
                    <div class="kpi-value text-yellow" id="balancePersonal">R$ 0,00</div>
                </div>
                <div class="card" style="display: flex; justify-content: center;">
                    <button class="btn btn-danger" onclick="handleTransaction('withdraw', 'personal')">Gastar</button>
                </div>
            </div>
            <div class="card">
                <div class="table-container">
                    <table><thead><tr><th>Data</th><th>Tipo</th><th>Desc</th><th>Valor</th><th>Ação</th></tr></thead><tbody id="tableBodyPersonal"></tbody></table>
                </div>
            </div>
        </section>

        <!-- APORTES -->
        <section id="aportes" class="page-section">
            <div class="page-header">
                <h2>Registrar Novo Aporte</h2>
                <p>O valor será debitado da <strong>Carteira de Giro</strong>.</p>
            </div>
            <div class="card">
                <form id="investForm">
                    <div class="form-grid">
                        <div>
                            <h4 style="margin-bottom: 15px; color: var(--accent-blue);">Dados do Ativo</h4>
                            <div class="form-group"><label>Nome</label><input type="text" id="inpName" class="form-control" required></div>
                            <div class="form-group"><label>Instituição</label>
                                <select id="inpInst" class="form-control"><option>XP Investimentos</option><option>BTG Pactual</option><option>NuInvest</option><option>Banco Inter</option></select>
                            </div>
                            <div class="form-group"><label>Tipo</label>
                                <select id="inpType" class="form-control"><option>Renda Fixa</option><option>Ações</option><option>FIIs</option><option>Cripto</option></select>
                            </div>
                            <div class="form-grid" style="gap: 10px;">
                                <div class="form-group"><label>Data</label><input type="date" id="inpDate" class="form-control" required></div>
                                <div class="form-group"><label>Vencimento</label><input type="date" id="inpExpiry" class="form-control"></div>
                            </div>
                            <div class="form-group"><label>Valor (R$)</label><input type="number" id="inpValue" class="form-control" step="0.01" required></div>
                        </div>
                        <div>
                            <h4 style="margin-bottom: 15px; color: var(--accent-green);">Taxas</h4>
                            <div class="rate-control-box">
                                <div class="form-group"><label>Taxa Prevista</label>
                                    <div style="display:flex; gap:10px;"><input type="number" id="inpRatePrev" class="form-control"><select id="inpRateTypePrev" class="form-control"><option>% CDI</option><option>% a.a.</option><option>IPCA +</option></select></div>
                                </div>
                                <div class="form-group" style="margin-top:20px;"><label>Status</label><select id="inpStatus" class="form-control"><option>Ativo</option><option>Finalizado</option></select></div>
                                <!-- Taxa Real omitida para simplificar visualização, pode manter se quiser -->
                                <input type="hidden" id="inpRateReal"> <input type="hidden" id="inpRateTypeReal">
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 20px; text-align: right;"><button class="btn btn-primary" type="submit">Registrar</button></div>
                </form>
            </div>
        </section>

        <!-- NOVO: PLANEJAMENTO (INPUT) -->
        <section id="planejamento" class="page-section">
            <div class="page-header">
                <h2>Definir Metas de Aporte</h2>
                <p>Estipule quanto você quer investir em cada mês para comparar depois.</p>
            </div>
            <div class="card">
                <form id="planForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Mês de Referência</label>
                            <input type="month" id="inpPlanMonth" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>Valor Meta (R$)</label>
                            <input type="number" id="inpPlanValue" class="form-control" placeholder="Ex: 5000.00" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label>Categoria (Opcional)</label>
                            <select id="inpPlanCategory" class="form-control">
                                <option value="Geral">Geral (Total)</option>
                                <option value="Renda Fixa">Renda Fixa</option>
                                <option value="Renda Variável">Renda Variável</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-primary" type="submit">Salvar Meta</button>
                </form>
            </div>
            
            <div class="card" style="margin-top: 30px;">
                <h3>Metas Definidas</h3>
                <div class="table-container">
                    <table>
                        <thead><tr><th>Mês/Ano</th><th>Categoria</th><th>Valor Meta</th><th>Ação</th></tr></thead>
                        <tbody id="plansTableBody"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- HISTÓRICO -->
        <section id="historico" class="page-section">
            <div class="page-header"><h2>Histórico</h2><button class="btn btn-danger" onclick="clearAllData()">Limpar Tudo</button></div>
            <div class="card"><div class="table-container"><table><thead><tr><th>Ativo</th><th>Data</th><th>Vencimento</th><th>Valor</th><th>Ação</th></tr></thead><tbody id="investTableBody"></tbody></table></div></div>
        </section>

        <section id="config" class="page-section"><div class="page-header"><h2>Configurações</h2></div><div class="card"><p>Configurações do sistema.</p></div></section>

    </main>

    <script src="script.js"></script>
</body>
</html>
